<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="song">
	
	<resultMap id="songExtMap" type="songExt">
		<id column="SONG_NO" property="songNo"/>
		<result column="SONG_MEMBER_NO" property="songMemberNo"/>
		<result column="SONG_MOOD_NO" property="songMoodNo"/>
		<result column="SONG_GENRE_NO" property="songGenreNo"/>
		<result column="SONG_IMAGE_NO" property="songImageNo"/>
		<result column="SONG_FILE_NO" property="songFileNo"/>
		<result column="SONG_PLACE_NO" property="songPlaceNo"/>
		<result column="SONG_TITLE" property="songTitle"/>
		<result column="SONG_LICENSE" property="songLicense"/>
		<result column="SONG_DETAIL" property="songDetail"/>
		<result column="SONG_CREATE_DATE" property="songCreateDate"/>
		<result column="SONG_MODIFY_DATE" property="songModifyDate"/>
		<result column="SONG_STATUS" property="songStatus"/>
		
		<result column="MEMBER_NICKNAME" property="memberNickname"/>
		<result column="MOOD_NAME" property="moodName"/>
		<result column="GENRE_NAME" property="genreName"/>
		
		<association property="songImage">
			<result column="SONG_IMAGE_PATH_NO" property="songImagePathNo"/>
			<result column="SONG_IMAGE_NAME" property="songImageName"/>
		</association>
		
		<association property="songFile">
			<result column="SONG_FILE_PATH_NO" property="songFilePathNo"/>
			<result column="SONG_FILE_CHANGE_NAME" property="songFileChangeName"/>
			<result column="SONG_FILE_ORIGIN_NAME" property="songFileOriginName"/>
			
			<result column="SONG_PATH_NAME" property="songPathName"/>
		</association>
	</resultMap>
	
	<select id="selectSong" resultMap="songExtMap">
		SELECT *
		FROM SONG
		WHERE SONG_NO = #{songNo} 
			AND SONG_STATUS = 'Y'
	</select>

	
	<select id="selectSongList" resultType="song">
		SELECT 
			S.SONG_NO,
			S.SONG_MEMBER_NO,
			S.SONG_MOOD_NO,
			S.SONG_GENRE_NO, 
			S.SONG_IMAGE_NO,
			S.SONG_FILE_NO,
			S.SONG_PLACE_NO,
			S.SONG_TITLE,
			S.SONG_LICENSE, 
			S.SONG_DETAIL,
			
			M.MEMBER_NICKNAME,
			
			G.GENRE_NAME,
			M.MOOD_NAME,
			
			I.SONG_IMAGE_PATH_NO,
			I.SONG_IMAGE_NAME,
			
			F.SONG_FILE_PATH_NO,
			F.SONG_FILE_CHANGE_NAME,
			F.SONG_FILE_ORIGIN_NAME,
			
			
			
		FROM SONG S
		LEFT JOIN MEMBER M ON (S.SONG_MEMBER_NO = M.MEMBER_NO)
		LEFT JOIN GENRE G ON (S.SONG_GENRE_NO = G.GENRE_NO)
		LEFT JOIN MOOD ON (S.SONG_MOOD_NO = M.MOOD_NO)
		LEFT JOIN SONG_IMAGE I USING (SONG_IMAGE_NO)

		LEFT JOIN SONG_FILE F USING (SONG_FILE_NO)
		LEFT JOIN SONG_PATH P ON (P.SONG_PATH_NO = F.SONG_SONG_PATH_NUMBER)
		
		
		WHERE SONG_PLACE_NO = #{placeNo}
			<if test="genreNo != 0">
				AND SONG_GENRE_NO = #{genreNo}
			</if>
			<if test="moodNo != 0">
				AND SONG_MOOD_NO = #{moodNo}m
			</if>
			<if test="!keyword.equals('')">
				AND (UPPER(SONG_TITLE) LIKE '%'||#{keyword}||'%' OR UPPER(MEMBER_NICKNAME) LIKE '%'||#{keyword}||'%')
			</if>
			AND SONG_STATUS = 'Y'
	</select>

	<select id="selectAllGenres" resultType="genre">
		SELECT *
		FROM GENRE
	</select>

	<select id="selectAllMoods" resultType="mood">
		SELECT *
		FROM MOOD
	</select>




</mapper>